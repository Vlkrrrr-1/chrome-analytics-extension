# üìä Chrome Analytics Extension - –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è

## üéØ –ß—Ç–æ —ç—Ç–æ?

**Chrome Analytics Extension** ‚Äî —ç—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ Chrome, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–±–∏—Ä–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É –æ –≤–∞—à–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

- ‚è±Ô∏è –í—Ä–µ–º—è –Ω–∞ —Å–∞–π—Ç–∞—Ö
- üìú –°–∫—Ä–æ–ª–ª —Å—Ç—Ä–∞–Ω–∏—Ü
- üé¨ –ú–µ–¥–∏–∞-—Å–æ–±—ã—Ç–∏—è (play/pause –≤–∏–¥–µ–æ)
- üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∞–π—Ç–æ–≤ (TTFB)
- üìä –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ CSV/JSON

---

## üß© –ß—Ç–æ –≤–æ–æ–±—â–µ —Ç–∞–∫–æ–µ Chrome Extension?

### –ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏

**Chrome Extension (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)** ‚Äî —ç—Ç–æ –º–∏–Ω–∏-–ø—Ä–æ–≥—Ä–∞–º–º–∞, –∫–æ—Ç–æ—Ä–∞—è **—Ä–∞—Å—à–∏—Ä—è–µ—Ç** –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞ Chrome.

**–ü—Ä–∏–º–µ—Ä—ã –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π:**

- üîê **Bitwarden** ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞—Ä–æ–ª–µ–π (–∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º)
- üö´ **uBlock Origin** ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫ —Ä–µ–∫–ª–∞–º—ã
- üé® **Dark Reader** ‚Äî —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –≤—Å–µ—Ö —Å–∞–π—Ç–æ–≤
- üìù **Grammarly** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- üìä **–ù–∞—à–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ** ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ **3 —á–∞—Å—Ç–µ–π**, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      CHROME BROWSER                     ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   POPUP      ‚îÇ  ‚îÇ   CONTENT    ‚îÇ  ‚îÇ  BACKGROUND  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   (UI)       ‚îÇ  ‚îÇ   SCRIPT     ‚îÇ  ‚îÇ   WORKER     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç   ‚îÇ  ‚îÇ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞  ‚îÇ  ‚îÇ –†–∞–±–æ—Ç–∞–µ—Ç –≤   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É   ‚îÇ  ‚îÇ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö‚îÇ  ‚îÇ —Ñ–æ–Ω–µ         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ popup.html   ‚îÇ  ‚îÇ content.js   ‚îÇ  ‚îÇ background.js‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ         ‚îÇ                  ‚îÇ                  ‚îÇ         ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îÇ                           |                             ‚îÇ
‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                      ‚îÇ
‚îÇ                    ‚îÇ  IndexedDB  ‚îÇ  (–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)       ‚îÇ
‚îÇ                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 1Ô∏è‚É£ **Popup (–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å)**

**–ß—Ç–æ:** –û–∫–æ—à–∫–æ, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∏–∫–æ–Ω–∫—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

**–ó–∞–¥–∞—á–∞:**

- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–≤—Ä–µ–º—è, —Å–∫—Ä–æ–ª–ª, —Å–æ–±—ã—Ç–∏—è)
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ (—Ç–æ–≥–ª—ã –≤–∫–ª/–≤—ã–∫–ª)
- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ CSV/JSON

**–ê–Ω–∞–ª–æ–≥–∏—è:** –ö–∞–∫ –ø—Ä–∏–±–æ—Ä–Ω–∞—è –ø–∞–Ω–µ–ª—å –≤ –º–∞—à–∏–Ω–µ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å, –±–µ–Ω–∑–∏–Ω, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É

#### 2Ô∏è‚É£ **Content Script (–®–ø–∏–æ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö)**

**–ß—Ç–æ:** –ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–Ω–∞ –∫–∞–∂–¥–æ–π –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–µ**

**–ó–∞–¥–∞—á–∞:**

- –°–ª–µ–¥–∏—Ç –∑–∞ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–∫—Ä–æ–ª–ª, –∫–ª–∏–∫–∏, —Ñ–æ–∫—É—Å)
- –õ–æ–≤–∏—Ç –º–µ–¥–∏–∞-—Å–æ–±—ã—Ç–∏—è (play/pause –≤–∏–¥–µ–æ)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Background Worker

**–ê–Ω–∞–ª–æ–≥–∏—è:** –ö–∞–∫ –¥–µ—Ç–µ–∫—Ç–∏–≤, –∫–æ—Ç–æ—Ä—ã–π —Å–∏–¥–∏—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —Å–∞–π—Ç–µ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

**–í–∞–∂–Ω–æ:** Content Script **–ù–ï –í–ò–î–ò–¢** –¥—Ä—É–≥–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç **–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ** –æ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–Ω–µ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å —Å–∞–π—Ç)

#### 3Ô∏è‚É£ **Background Worker (–ú–æ–∑–≥ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)**

**–ß—Ç–æ:** –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü**

**–ó–∞–¥–∞—á–∞:**

- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç Content Scripts
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ IndexedDB (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (isPaused, isMedia, etc)
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –∫–æ–≥–¥–∞ –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã

**–ê–Ω–∞–ª–æ–≥–∏—è:** –ö–∞–∫ —Å–µ—Ä–≤–µ—Ä ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –±–∞–∑—É

---

### –ö–∞–∫ –æ–Ω–∏ –æ–±—â–∞—é—Ç—Å—è?

```typescript
// 1. Content Script –≤–∏–¥–∏—Ç —Å–æ–±—ã—Ç–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
window.addEventListener("scroll", () => {
  // 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Background
  chrome.runtime.sendMessage({
    type: "scroll",
    scroll: 50,
    page: { url: "youtube.com", title: "YouTube" },
  });
});

// 3. Background –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
chrome.runtime.onMessage.addListener((message) => {
  // 4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ IndexedDB
  saveEvent(message);
});

// 5. Popup —á–∏—Ç–∞–µ—Ç –∏–∑ IndexedDB
const events = await getAllEvents();
// 6. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
console.log("–°–æ–±—ã—Ç–∏–π –∑–∞ —Å–µ–≥–æ–¥–Ω—è:", events.length);
```

---

### –û—Ç–∫—É–¥–∞ Chrome –∑–Ω–∞–µ—Ç –æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏?

–í—Å—ë –æ–ø–∏—Å–∞–Ω–æ –≤ —Ñ–∞–π–ª–µ **`manifest.json`** (–≥–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥):

```json
{
  "manifest_version": 3,
  "name": "Analytics Extension",
  "permissions": ["storage", "tabs"], // –ß—Ç–æ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å

  "background": {
    "service_worker": "background.js" // –§–æ–Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
  },

  "content_scripts": [
    {
      "matches": ["<all_urls>"], // –ù–∞ –∫–∞–∫–∏—Ö —Å–∞–π—Ç–∞—Ö –∑–∞–ø—É—Å–∫–∞—Ç—å
      "js": ["content.js"] // –ö–∞–∫–æ–π —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–∞—Ç—å
    }
  ],

  "action": {
    "default_popup": "popup.html" // –ß—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏ –∫–ª–∏–∫–µ
  }
}
```

**Chrome —á–∏—Ç–∞–µ—Ç manifest.json –∏:**

1. –ó–∞–ø—É—Å–∫–∞–µ—Ç `background.js` –≤ —Ñ–æ–Ω–µ
2. –ò–Ω—ä–µ–∫—Ç–∏—Ä—É–µ—Ç `content.js` –Ω–∞ –≤—Å–µ —Å–∞–π—Ç—ã (`<all_urls>`)
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–∫–æ–Ω–∫—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
4. –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∏–∫–æ–Ω–∫—É ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `popup.html`

---

### –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ?

–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **IndexedDB** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

```
IndexedDB: "analytics"
  ‚îî‚îÄ‚îÄ –¢–∞–±–ª–∏—Ü–∞: "events"
      ‚îú‚îÄ‚îÄ { id: 1, type: "page_view", url: "youtube.com", ts: "2025-10-06..." }
      ‚îú‚îÄ‚îÄ { id: 2, type: "scroll", scroll: 75, ts: "2025-10-06..." }
      ‚îú‚îÄ‚îÄ { id: 3, type: "media_play", src: "video.mp4", ts: "2025-10-06..." }
      ‚îî‚îÄ‚îÄ ...
```

**–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ:**

1. F12 (DevTools)
2. –í–∫–ª–∞–¥–∫–∞ **Application**
3. –†–∞–∑–¥–µ–ª **IndexedDB ‚Üí analytics ‚Üí events**

---

### –ß—Ç–æ –º–æ–∂–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ? (Permissions)

–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤ `manifest.json`:

```json
"permissions": ["storage", "tabs"]
```

**–ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç:**

- ‚úÖ `storage` ‚Äî –¥–æ—Å—Ç—É–ø –∫ `chrome.storage` (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- ‚úÖ `tabs` ‚Äî –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∫–ª–∞–¥–∫–∞—Ö (url, title, favicon)

**–ß—Ç–æ –ù–ï –º–æ–∂–µ—Ç –±–µ–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è:**

- ‚ùå –ß–∏—Ç–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –±—Ä–∞—É–∑–µ—Ä–∞ (–Ω—É–∂–µ–Ω `history`)
- ‚ùå –î–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã (–Ω—É–∂–µ–Ω `activeTab` + API)
- ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–∞–π—Ç—ã (–Ω—É–∂–µ–Ω `declarativeNetRequest`)

---

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Chrome
   ‚îî‚îÄ‚Üí Background Worker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç youtube.com
   ‚îî‚îÄ‚Üí Content Script –∏–Ω—ä–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
       ‚îî‚îÄ‚Üí –ù–∞—á–∏–Ω–∞–µ—Ç —Å–ª—É—à–∞—Ç—å —Å–æ–±—ã—Ç–∏—è (scroll, click, etc)

3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫—Ä–æ–ª–ª–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É
   ‚îî‚îÄ‚Üí Content Script –ª–æ–≤–∏—Ç —Å–æ–±—ã—Ç–∏–µ
       ‚îî‚îÄ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Background Worker
           ‚îî‚îÄ‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ IndexedDB

4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –∏–∫–æ–Ω–∫—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
   ‚îî‚îÄ‚Üí Popup –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
       ‚îî‚îÄ‚Üí –ß–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ IndexedDB
           ‚îî‚îÄ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤–∫–ª–∞–¥–∫—É
   ‚îî‚îÄ‚Üí Content Script —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è
       ‚îî‚îÄ‚Üí Background Worker –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫—Ä—ã–≤–∞–µ—Ç Chrome
   ‚îî‚îÄ‚Üí Background Worker –∑–∞—Å—ã–ø–∞–µ—Ç (–≤ v3)
       ‚îî‚îÄ‚Üí IndexedDB —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
```

---

### –û—Ç–ª–∏—á–∏–µ –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

| –§–∏—á–∞                | –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ               | Chrome Extension               |
| ------------------- | ---------------------------- | ------------------------------ |
| –ì–¥–µ —Ä–∞–±–æ—Ç–∞–µ—Ç        | –ù–∞ –æ–¥–Ω–æ–º —Å–∞–π—Ç–µ (example.com) | –ù–∞ **–≤—Å–µ—Ö** —Å–∞–π—Ç–∞—Ö             |
| –î–æ—Å—Ç—É–ø –∫ Chrome API | ‚ùå –ù–µ—Ç                       | ‚úÖ –ï—Å—Ç—å (`chrome.*`)           |
| –î–æ—Å—Ç—É–ø –∫ –≤–∫–ª–∞–¥–∫–∞–º   | ‚ùå –¢–æ–ª—å–∫–æ —Å–≤–æ—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞      | ‚úÖ –í—Å–µ –≤–∫–ª–∞–¥–∫–∏                 |
| –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω     | ‚ùå –ù—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä              | ‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞              |
| –£—Å—Ç–∞–Ω–æ–≤–∫–∞           | –ü—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä—ã—Ç—å URL           | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ Chrome Web Store |

---

### –ò—Ç–æ–≥–æ –ø—Ä–æ Chrome Extension:

‚úÖ **–ú–∏–Ω–∏-–ø—Ä–æ–≥—Ä–∞–º–º–∞** –≤–Ω—É—Ç—Ä–∏ –±—Ä–∞—É–∑–µ—Ä–∞
‚úÖ **3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞**: Popup (UI), Content Script (—à–ø–∏–æ–Ω), Background (–º–æ–∑–≥)
‚úÖ **manifest.json** ‚Äî –≥–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ (—á—Ç–æ, –≥–¥–µ, –∫–∞–∫)
‚úÖ **–û–±—â–µ–Ω–∏–µ** —á–µ—Ä–µ–∑ `chrome.runtime.sendMessage()`
‚úÖ **IndexedDB** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±—Ä–∞—É–∑–µ—Ä–µ
‚úÖ **Permissions** ‚Äî —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å —á—Ç–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å
‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ** ‚Äî –Ω–∞ –≤—Å–µ—Ö —Å–∞–π—Ç–∞—Ö (`<all_urls>`)

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ–∫–ª–∞–º—ã, –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —á–µ–≥–æ —É–≥–æ–¥–Ω–æ! üöÄ

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

Chrome Extension —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ **—Ç—Ä—ë—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**:

### 1Ô∏è‚É£ **Content Script** (`src/content.tsx`)

**–ß—Ç–æ —ç—Ç–æ?** –ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π **–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ** –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

**–ó–∞–¥–∞—á–∏:**

- üëÄ –°–ª–µ–¥–∏—Ç –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–∫—Ä–æ–ª–ª, –∫–ª–∏–∫–∏, —Ñ–æ–∫—É—Å)
- ‚è±Ô∏è –ó–∞–º–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- üé¨ –õ–æ–≤–∏—Ç –º–µ–¥–∏–∞-—Å–æ–±—ã—Ç–∏—è (play/pause)
- üöÄ –ò–∑–º–µ—Ä—è–µ—Ç TTFB (Time To First Byte)
- üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ Background Worker

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**

```typescript
// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∞
window.addEventListener("scroll", () => {
  const scrollPercent =
    (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;
  chrome.runtime.sendMessage({
    type: "scroll",
    scroll: Math.round(scrollPercent),
    page: {
      url: window.location.href,
      title: document.title,
      favicon: getFavicon(),
    },
  });
});
```

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**

- ‚úÖ Content script **–ù–ï –ú–û–ñ–ï–¢** –Ω–∞–ø—Ä—è–º—É—é —Ä–∞–±–æ—Ç–∞—Ç—å —Å IndexedDB
- ‚úÖ Content script **–ú–û–ñ–ï–¢** –æ–±—â–∞—Ç—å—Å—è —Å Background —á–µ—Ä–µ–∑ `chrome.runtime.sendMessage()`
- ‚úÖ –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –æ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ)

---

### 2Ô∏è‚É£ **Background Worker** (`src/background.ts`)

**–ß—Ç–æ —ç—Ç–æ?** Service Worker, –∫–æ—Ç–æ—Ä—ã–π **—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ** –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–º–∏.

**–ó–∞–¥–∞—á–∏:**

- üì• –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –æ—Ç Content Scripts
- üíæ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ IndexedDB
- ‚öôÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`chrome.storage.sync`)
- üîÑ –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ (–Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–æ–∫)

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**

```typescript
// –ü—Ä–∏—ë–º —Å–æ–±—ã—Ç–∏–π –æ—Ç Content Script
chrome.runtime.onMessage.addListener((message) => {
  console.log("Event received:", message);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ IndexedDB
  saveEvent({
    type: message.type,
    ts: new Date().toISOString(),
    page: message.page,
    scroll: message.scroll,
    // ...
  });
});
```

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**

- ‚úÖ Background **–ú–û–ñ–ï–¢** —Ä–∞–±–æ—Ç–∞—Ç—å —Å IndexedDB
- ‚úÖ Background **–ú–û–ñ–ï–¢** —Ä–∞–±–æ—Ç–∞—Ç—å —Å `chrome.storage`
- ‚úÖ Background —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ "—Å–µ—Ä–≤–µ—Ä" –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

---

### 3Ô∏è‚É£ **Popup** (`src/popup.tsx`)

**–ß—Ç–æ —ç—Ç–æ?** –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π **–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∏–∫–æ–Ω–∫—É**.

**–ó–∞–¥–∞—á–∏:**

- üìä –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–≤—Ä–µ–º—è, —Å–∫—Ä–æ–ª–ª, —Å–æ–±—ã—Ç–∏—è)
- ‚öôÔ∏è –£–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ (—Ç–æ–≥–ª—ã, —Ä–µ–∂–∏–º—ã)
- üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (CSV, JSON)
- üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**

```typescript
// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ IndexedDB
useEffect(() => {
  const fetchData = async () => {
    const time = await getTimeToday();
    setActiveTimeToday(time);
  };
  fetchData();
}, []);
```

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**

- ‚úÖ Popup **–ú–û–ñ–ï–¢** —Ä–∞–±–æ—Ç–∞—Ç—å —Å IndexedDB (–µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á—ë–Ω db.ts)
- ‚úÖ Popup **–ú–û–ñ–ï–¢** —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å –≤ `chrome.storage`
- ‚úÖ Popup –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –Ω–µ–≥–æ (state –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

---

## üóÑÔ∏è IndexedDB ‚Äî –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º

### –ß—Ç–æ —ç—Ç–æ?

**IndexedDB** ‚Äî —ç—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ö–∞–∫ SQLite, —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–µ–±–∞.

**–ó–∞—á–µ–º –Ω—É–∂–Ω–∞?**

- üíæ –•—Ä–∞–Ω–∏—Ç—å –ú–ù–û–ì–û –¥–∞–Ω–Ω—ã—Ö (–≥–∏–≥–∞–±–∞–π—Ç—ã, –Ω–µ –∫–∞–∫ localStorage —Å 5MB –ª–∏–º–∏—Ç–æ–º)
- üöÄ –ë—ã—Å—Ç—Ä–∞—è —Ä–∞–±–æ—Ç–∞ (–∏–Ω–¥–µ–∫—Å—ã, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
- üìä –•—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ (–Ω–µ –Ω—É–∂–Ω–æ JSON.stringify)

### –ö–∞–∫–æ–π —Ç–∏–ø –±–∞–∑—ã?

**NoSQL (Key-Value)** ‚Äî –∫–∞–∫ MongoDB –∏–ª–∏ Redis.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: "analytics"
  ‚îî‚îÄ‚îÄ –¢–∞–±–ª–∏—Ü–∞ (store): "events"
      ‚îú‚îÄ‚îÄ –ó–∞–ø–∏—Å—å 1: { id: 1, type: "page_view", ts: "2025-10-06..." }
      ‚îú‚îÄ‚îÄ –ó–∞–ø–∏—Å—å 2: { id: 2, type: "scroll", scroll: 50, ... }
      ‚îî‚îÄ‚îÄ –ó–∞–ø–∏—Å—å 3: { id: 3, type: "media_play", src: "video.mp4" }
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –Ω–∞—à–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏?

#### 1. **–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã** (—Ñ–∞–π–ª `db.ts`)

```typescript
import { openDB } from "idb"; // –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã

const dbPromise = openDB("analytics", 1, {
  upgrade(db) {
    // –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É "events" –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
    db.createObjectStore("events", {
      keyPath: "id", // –ü–æ–ª–µ id ‚Äî –∫–ª—é—á
      autoIncrement: true, // id –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (1, 2, 3...)
    });
  },
});
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –±–∞–∑–∞ `analytics` –≤–µ—Ä—Å–∏–∏ 1
- –í–Ω—É—Ç—Ä–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ `events`
- –ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `id` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

#### 2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è** (—Ñ—É–Ω–∫—Ü–∏—è `saveEvent`)

```typescript
export async function saveEvent(event: EventRecord) {
  const db = await dbPromise; // –û—Ç–∫—Ä—ã–≤–∞–µ–º –±–∞–∑—É
  const eventWithSaveTime = {
    ...event, // –ë–µ—Ä—ë–º –≤—Å–µ –ø–æ–ª—è —Å–æ–±—ã—Ç–∏—è
    saved_at: new Date().toISOString(), // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  };
  await db.add("events", eventWithSaveTime); // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É "events"
}
```

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. Background Worker –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –æ—Ç Content Script
2. –í—ã–∑—ã–≤–∞–µ—Ç `saveEvent(event)`
3. IndexedDB –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É `events`
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è `id`

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏:**

```json
{
  "id": 42,
  "type": "page_view",
  "ts": "2025-10-06T14:30:00.000Z",
  "saved_at": "2025-10-06T14:30:00.123Z",
  "page": {
    "url": "https://youtube.com",
    "title": "YouTube",
    "favicon": "https://youtube.com/favicon.ico"
  }
}
```

#### 3. **–ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** (—Ñ—É–Ω–∫—Ü–∏—è `getAllEvents`)

```typescript
export async function getAllEvents(): Promise<EventRecord[]> {
  const db = await dbPromise;
  return db.getAll("events"); // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –í–°–ï –∑–∞–ø–∏—Å–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
}
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**

- –í Popup –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –í —ç–∫—Å–ø–æ—Ä—Ç–µ CSV/JSON

#### 4. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** (–ø—Ä–∏–º–µ—Ä: —Å–æ–±—ã—Ç–∏—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è)

```typescript
export async function getTimeToday(): Promise<string> {
  const db = await dbPromise;
  const allEvents = await db.getAll("events");

  // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è
  const today = new Date().toDateString();
  const todayEvents = allEvents.filter((event) => {
    return new Date(event.ts).toDateString() === today;
  });

  // –°—á–∏—Ç–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ –≤—Ä–µ–º—è
  const activeEvents = todayEvents.filter((e) => e.type === "active_time");
  const totalSeconds = activeEvents.length * 5; // –ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ = 5 —Å–µ–∫

  return formatTime(totalSeconds);
}
```

#### 5. **–£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö** (—Ñ—É–Ω–∫—Ü–∏—è `clearEvents`)

```typescript
export async function clearEvents() {
  const db = await dbPromise;
  await db.clear("events"); // –û—á–∏—â–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª–Ω–æ—Å—Ç—å—é
}
```

### –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ IndexedDB?

| –§–∏—á–∞       | localStorage  | Chrome Storage | IndexedDB ‚úÖ   |
| ---------- | ------------- | -------------- | -------------- |
| –û–±—ä—ë–º      | 5-10 MB       | 100 KB (sync)  | –ì–∏–≥–∞–±–∞–π—Ç—ã      |
| –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –°—Ç—Ä–æ–∫–∏        | JSON           | –û–±—ä–µ–∫—Ç—ã        |
| –°–∫–æ—Ä–æ—Å—Ç—å   | –°—Ä–µ–¥–Ω—è—è       | –ú–µ–¥–ª–µ–Ω–Ω–∞—è      | –ë—ã—Å—Ç—Ä–∞—è        |
| Async      | ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è | ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è | ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è |
| –ò–Ω–¥–µ–∫—Å—ã    | ‚ùå            | ‚ùå             | ‚úÖ             |

### –ì–¥–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±–∞–∑—É?

1. –û—Ç–∫—Ä–æ–π DevTools (F12)
2. –í–∫–ª–∞–¥–∫–∞ **Application**
3. –†–∞–∑–¥–µ–ª **Storage ‚Üí IndexedDB**
4. –ù–∞–π–¥–∏ –±–∞–∑—É `analytics`
5. –û—Ç–∫—Ä–æ–π —Ç–∞–±–ª–∏—Ü—É `events` ‚Äî —É–≤–∏–¥–∏—à—å –≤—Å–µ –∑–∞–ø–∏—Å–∏!

### –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `idb` ‚Äî –∑–∞—á–µ–º?

–ù–∞—Ç–∏–≤–Ω—ã–π API IndexedDB —Å–ª–æ–∂–Ω—ã–π –∏ –º–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–π. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `idb` —É–ø—Ä–æ—â–∞–µ—Ç:

**–ë–µ–∑ idb (40 —Å—Ç—Ä–æ–∫):**

```typescript
const request = indexedDB.open("analytics", 1);
request.onsuccess = () => {
  const db = request.result;
  const transaction = db.transaction("events", "readwrite");
  const store = transaction.objectStore("events");
  const addRequest = store.add(event);
  addRequest.onsuccess = () => console.log("Saved!");
};
```

**–° idb (2 —Å—Ç—Ä–æ–∫–∏):**

```typescript
const db = await openDB("analytics", 1);
await db.add("events", event);
```

### –ò—Ç–æ–≥–æ –ø—Ä–æ IndexedDB:

‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** –≤ –±—Ä–∞—É–∑–µ—Ä–µ (NoSQL, Key-Value)
‚úÖ **–•—Ä–∞–Ω–∏—Ç —Å–æ–±—ã—Ç–∏—è** (page_view, scroll, media, etc)
‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI)
‚úÖ **–ú–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –≥–∏–≥–∞–±–∞–π—Ç—ã** –¥–∞–Ω–Ω—ã—Ö
‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Background/Popup**, –ù–ï –≤ Content Script
‚úÖ **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ idb** —É–ø—Ä–æ—â–∞–µ—Ç –∫–æ–¥ –≤ 10 —Ä–∞–∑

---

## üì° –ö–∞–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–±—â–∞—é—Ç—Å—è?

### 1. Content Script ‚Üí Background Worker

**–ß–µ—Ä–µ–∑ `chrome.runtime.sendMessage()`**

```typescript
// Content Script –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ
chrome.runtime.sendMessage({
  type: "page_view",
  page: { url: "...", title: "..." },
});

// Background –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ
chrome.runtime.onMessage.addListener((message) => {
  console.log("Received:", message);
  saveEvent(message);
});
```

### 2. Popup ‚Üî IndexedDB

**–ù–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `db.ts`**

```typescript
// Popup —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
import { getTimeToday } from "./libs/db";

const time = await getTimeToday();
```

### 3. Popup ‚Üî Chrome Storage

**–ß–µ—Ä–µ–∑ `chrome.storage.sync`**

```typescript
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
chrome.storage.sync.set({ isPaused: false });

// –ß—Ç–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
chrome.storage.sync.get(["isPaused"], (result) => {
  console.log("isPaused:", result.isPaused);
});
```

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### EventRecord (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–±—ã—Ç–∏—è)

```typescript
interface EventRecord {
  id?: number; // ID –≤ IndexedDB
  type: string; // –¢–∏–ø —Å–æ–±—ã—Ç–∏—è (page_view, scroll, etc)
  ts: string; // Timestamp (ISO —Å—Ç—Ä–æ–∫–∞)
  session_id?: string; // ID —Å–µ—Å—Å–∏–∏
  scroll?: number; // –ü—Ä–æ—Ü–µ–Ω—Ç —Å–∫—Ä–æ–ª–ª–∞ (0-100)
  ttfb?: number; // Time To First Byte (ms)
  src?: string; // URL –º–µ–¥–∏–∞ (–¥–ª—è –≤–∏–¥–µ–æ)
  currentTime?: number; // –í—Ä–µ–º—è –≤–∏–¥–µ–æ
  saved_at?: string; // –í—Ä–µ–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±–∞–∑—É
  page?: {
    url: string;
    title: string;
    favicon: string;
  };
}
```

### Chrome Storage (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

```typescript
{
  isPaused: boolean; // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–±–æ—Ä
  isIncognito: boolean; // –°–æ–±–∏—Ä–∞—Ç—å –≤ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ
  isClick: boolean; // –°–æ–±–∏—Ä–∞—Ç—å –∫–ª–∏–∫–∏/—Å–∫—Ä–æ–ª–ª
  isMedia: boolean; // –°–æ–±–∏—Ä–∞—Ç—å –º–µ–¥–∏–∞-—Å–æ–±—ã—Ç–∏—è
}
```

---

## üîß –ö–∞–∫ —è –≤—Å—ë –¥–µ–ª–∞–ª?

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
npm create vite@latest my-extension -- --template react-ts
cd my-extension
npm install
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install @chakra-ui/react @emotion/react idb
npm install -D vite-plugin-static-copy
```

### –®–∞–≥ 3: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vite

–°–æ–∑–¥–∞–ª **–¥–≤–∞ –∫–æ–Ω—Ñ–∏–≥–∞**:

- `vite.config.ts` ‚Äî –¥–ª—è Popup
- `vite.config.content.ts` ‚Äî –¥–ª—è Content Script

### –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ Manifest

```json
{
  "manifest_version": 3,
  "name": "Analytics Extension",
  "version": "1.0",
  "permissions": ["storage", "tabs"],
  "background": {
    "service_worker": "dist/background.js"
  },
  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["dist/content.js"]
    }
  ],
  "action": {
    "default_popup": "dist/popup.html"
  }
}
```

### –®–∞–≥ 5: –°–±–æ—Ä–∫–∞

```bash
npm run build
```

### –®–∞–≥ 6: –ó–∞–≥—Ä—É–∑–∫–∞ –≤ Chrome

1. –û—Ç–∫—Ä—ã—Ç—å `chrome://extensions/`
2. –í–∫–ª—é—á–∏—Ç—å "–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞"
3. –ù–∞–∂–∞—Ç—å "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ"
4. –í—ã–±—Ä–∞—Ç—å –ø–∞–ø–∫—É `dist/`

---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç —Å—Ç–µ–∫?

–Ø –≤—ã–±—Ä–∞–ª —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è Chrome Extension:

### Frontend (Popup UI)

#### **React + TypeScript**

```json
"react": "^18.3.1",
"typescript": "~5.6.2"
```

**–ü–æ—á–µ–º—É React?**

- ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–ª–µ–≥–∫–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å UI)
- ‚úÖ –•—É–∫–∏ (useState, useEffect) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- ‚úÖ –û–≥—Ä–æ–º–Ω–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫
- ‚úÖ –Ø —É–∂–µ –∑–Ω–∞–∫–æ–º —Å React (–±—ã—Å—Ç—Ä–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

**–ü–æ—á–µ–º—É TypeScript?**

- ‚úÖ –¢–∏–ø–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ —Å `chrome.*` API)
- ‚úÖ –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ IDE (VSCode)
- ‚úÖ –õ–µ–≥—á–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –∫–æ–¥
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ç–∏–ø—ã

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**

- ‚ùå Vanilla JS ‚Äî –º–Ω–æ–≥–æ boilerplate, –Ω–µ—Ç —Ç–∏–ø–æ–≤
- ‚ùå Vue/Svelte ‚Äî –º–µ–Ω—å—à–µ —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- ‚ùå Angular ‚Äî —Å–ª–∏—à–∫–æ–º —Ç—è–∂—ë–ª—ã–π –¥–ª—è –º–∞–ª–µ–Ω—å–∫–æ–≥–æ popup

---

#### **Chakra UI**

```json
"@chakra-ui/react": "^2.10.4"
```

**–ü–æ—á–µ–º—É Chakra UI?**

- ‚úÖ –ì–æ—Ç–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (Box, Flex, Text, Switch)
- ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ (—Ü–≤–µ—Ç–∞, —Ç–µ–Ω–∏, –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã)
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- ‚úÖ –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ (dark mode) –ª–µ–≥–∫–æ
- ‚úÖ Accessibility (a11y) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```tsx
<Box bg="blue.500" p={4} borderRadius="md">
  <Text color="white">–ö—Ä–∞—Å–∏–≤–æ –∏ –ø—Ä–æ—Å—Ç–æ!</Text>
</Box>
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**

- ‚ùå Material UI ‚Äî —Å–ª–∏—à–∫–æ–º —Ç—è–∂—ë–ª—ã–π (–±–æ–ª—å—à–æ–π bundle)
- ‚ùå Tailwind CSS ‚Äî –º–Ω–æ–≥–æ –∫–ª–∞—Å—Å–æ–≤ –≤ JSX
- ‚ùå Styled Components ‚Äî –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –∫–æ–¥–∞

---

### –°–±–æ—Ä–∫–∞ (Build Tool)

#### **Vite**

```json
"vite": "^6.0.11"
```

**–ü–æ—á–µ–º—É Vite?**

- ‚ö° **–°—É–ø–µ—Ä –±—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞** (HMR –∑–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TypeScript –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- ‚úÖ –î–≤–∞ –∫–æ–Ω—Ñ–∏–≥–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö entry points:
  - `vite.config.ts` ‚Üí Popup (popup.html)
  - `vite.config.content.ts` ‚Üí Content Script (content.ts)
- ‚úÖ Tree-shaking (—É–¥–∞–ª—è–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥)
- ‚úÖ ES Modules (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç)

**–ö–æ–Ω—Ñ–∏–≥ –¥–ª—è Popup:**

```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      input: {
        popup: resolve(__dirname, "popup.html"),
      },
    },
  },
});
```

**–ö–æ–Ω—Ñ–∏–≥ –¥–ª—è Content Script:**

```typescript
// vite.config.content.ts
export default defineConfig({
  build: {
    lib: {
      entry: resolve(__dirname, "src/content.tsx"),
      formats: ["iife"], // –î–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
      name: "ContentScript",
      fileName: "content",
    },
  },
});
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**

- ‚ùå Webpack ‚Äî –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —Å–ª–æ–∂–Ω–µ–µ –∫–æ–Ω—Ñ–∏–≥
- ‚ùå Parcel ‚Äî –º–µ–Ω—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è
- ‚ùå Rollup ‚Äî –Ω—É–∂–Ω–æ –≤—Å—ë –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é

---

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### **IndexedDB + idb**

```json
"idb": "^8.0.1"
```

**–ü–æ—á–µ–º—É IndexedDB?**

- üíæ **–ì–∏–≥–∞–±–∞–π—Ç—ã –¥–∞–Ω–Ω—ã—Ö** (vs 5MB localStorage)
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI)
- ‚úÖ –•—Ä–∞–Ω–∏—Ç –æ–±—ä–µ–∫—Ç—ã –Ω–∞–ø—Ä—è–º—É—é (–Ω–µ –Ω—É–∂–µ–Ω JSON.stringify)
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω

**–ü–æ—á–µ–º—É –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ idb?**

- ‚úÖ –£–ø—Ä–æ—â–∞–µ—Ç –Ω–∞—Ç–∏–≤–Ω—ã–π API –≤ 10 —Ä–∞–∑
- ‚úÖ Promise-based (async/await)
- ‚úÖ –ú–∞–ª–µ–Ω—å–∫–∏–π —Ä–∞–∑–º–µ—Ä (3KB)

**–ü—Ä–∏–º–µ—Ä:**

```typescript
// –ë–µ–∑ idb (40 —Å—Ç—Ä–æ–∫) ‚ùå
const request = indexedDB.open("db", 1);
request.onsuccess = () => { ... }

// –° idb (2 —Å—Ç—Ä–æ–∫–∏) ‚úÖ
const db = await openDB("db", 1);
await db.add("store", data);
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**

- ‚ùå localStorage ‚Äî –ª–∏–º–∏—Ç 5MB, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π
- ‚ùå Chrome Storage ‚Äî –ª–∏–º–∏—Ç 100KB (sync), –º–µ–¥–ª–µ–Ω–Ω—ã–π
- ‚ùå SQLite (WebSQL) ‚Äî deprecated, –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

---

### –ü–ª–∞–≥–∏–Ω—ã –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

#### **vite-plugin-static-copy**

```json
"vite-plugin-static-copy": "^2.1.0"
```

**–ó–∞—á–µ–º?**

- üì¶ –ö–æ–ø–∏—Ä—É–µ—Ç `manifest.json` –∏ `icons/` –≤ `dist/` –ø—Ä–∏ —Å–±–æ—Ä–∫–µ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (–Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å)

**–ö–æ–Ω—Ñ–∏–≥:**

```typescript
import { viteStaticCopy } from "vite-plugin-static-copy";

export default defineConfig({
  plugins: [
    viteStaticCopy({
      targets: [
        { src: "public/manifest.json", dest: "." },
        { src: "public/icons", dest: "." },
      ],
    }),
  ],
});
```

---

### –ü–æ–ª–Ω—ã–π —Å—Ç–µ–∫

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è        | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è      | –ü–æ—á–µ–º—É                       |
| ---------------- | --------------- | ---------------------------- |
| **UI Framework** | React 18        | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, —Ö—É–∫–∏, —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ |
| **–Ø–∑—ã–∫**         | TypeScript      | –¢–∏–ø–∏–∑–∞—Ü–∏—è, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å      |
| **UI Library**   | Chakra UI       | –ì–æ—Ç–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∫—Ä–∞—Å–∏–≤–æ  |
| **–°–±–æ—Ä–∫–∞**       | Vite            | –ë—ã—Å—Ç—Ä–∞—è, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ TS        |
| **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**  | IndexedDB + idb | –ú–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö, async          |
| **–°—Ç–µ–π—Ç**        | React useState  | –ü—Ä–æ—Å—Ç–æ, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è popup |
| **–ò–∫–æ–Ω–∫–∏**       | React Icons     | FontAwesome, Material Icons  |
| **–õ–∏–Ω—Ç–µ—Ä**       | ESLint          | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞                |

---

### –†–∞–∑–º–µ—Ä bundle (–ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏)

```bash
dist/popup.js       447.91 kB  (gzip: 142 kB)  # Popup + React + Chakra
dist/content.js       5.94 kB  (gzip: 1.69 kB)  # Content Script (–º–∞–ª–µ–Ω—å–∫–∏–π!)
dist/background.js    0.24 kB  (gzip: 0.21 kB)  # Background Worker
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

- ‚úÖ Tree-shaking (Vite —É–¥–∞–ª—è–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥)
- ‚úÖ Gzip compression (~70% –º–µ–Ω—å—à–µ)
- ‚úÖ Content Script –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (—Ç–æ–ª—å–∫–æ —Å–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π)
- ‚úÖ React —Ç–æ–ª—å–∫–æ –≤ Popup (–Ω–µ –≤ Content Script)

---

### –ß—Ç–æ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∏ –ø–æ—á–µ–º—É

‚ùå **Redux / Zustand / MobX** ‚Äî –¥–ª—è popup –∏–∑–±—ã—Ç–æ—á–Ω–æ, useState –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
‚ùå **GraphQL / tRPC** ‚Äî –Ω–µ—Ç –±—ç–∫–µ–Ω–¥–∞, —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞
‚ùå **Next.js / Remix** ‚Äî —ç—Ç–æ –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –Ω–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
‚ùå **Tailwind CSS** ‚Äî Chakra UI —É–¥–æ–±–Ω–µ–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚ùå **Jest / Vitest** ‚Äî –ø–æ–∫–∞ –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤ (–Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å)

---

### –ò—Ç–æ–≥–æ –ø—Ä–æ —Å—Ç–µ–∫:

‚úÖ **React + TypeScript** ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚úÖ **Chakra UI** ‚Äî –∫—Ä–∞—Å–∏–≤—ã–π UI –±–µ–∑ —É—Å–∏–ª–∏–π
‚úÖ **Vite** ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞ –∏ HMR
‚úÖ **IndexedDB + idb** ‚Äî –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–æ—Å—Ç–æ —Ä–∞–±–æ—Ç–∞—Ç—å
‚úÖ **–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π** ‚Äî —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
‚úÖ **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π** ‚Äî ES Modules, async/await, TypeScript

–≠—Ç–æ—Ç —Å—Ç–µ–∫ –ø–æ–∑–≤–æ–ª–∏–ª —Å–æ–∑–¥–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ **–±—ã—Å—Ç—Ä–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ –∫—Ä–∞—Å–∏–≤–æ**! üöÄ

---

## üé® UI/UX: 3 —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

### Basic (–ë–∞–∑–æ–≤—ã–π)

- üìä –ü—Ä–æ—Å—Ç—ã–µ –º–µ—Ç—Ä–∏–∫–∏: –≤—Ä–µ–º—è, —Å–∫—Ä–æ–ª–ª
- üéõÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–æ–≥–ª—ã
- üì§ –≠–∫—Å–ø–æ—Ä—Ç CSV/JSON

### Pro (–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)

- üìà –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- üåê –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º —Å–∞–π—Ç–µ
- üìä –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

### Enterprise (–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π)

- üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (TTFB)
- üé¨ –ú–µ–¥–∏–∞-—Å–æ–±—ã—Ç–∏—è
- üìä –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ (—Å–æ–±—ã—Ç–∏—è/–º–∏–Ω, –∑–∞–¥–µ—Ä–∂–∫–∞)
- üî• –†–µ–∞–ª—Ç–∞–π–º-–º–µ—Ç—Ä–∏–∫–∏

---

## üìã Manifest v3 ‚Äî –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º

### –ß—Ç–æ —ç—Ç–æ?

**manifest.json** ‚Äî —ç—Ç–æ –≥–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è. –ö–∞–∫ `package.json` –¥–ª—è npm, —Ç–æ–ª—å–∫–æ –¥–ª—è Chrome Extension.

**–ó–∞—á–µ–º –Ω—É–∂–µ–Ω?**

- üìù –û–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (–∏–º—è, –≤–µ—Ä—Å–∏—è, –∏–∫–æ–Ω–∫–∏)
- üîê –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (permissions)
- üéØ –£–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å (background, content, popup)
- ‚öôÔ∏è –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

### Manifest v3 vs v2

Chrome –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ **Manifest v3** (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è v2 —É—Å—Ç–∞—Ä–µ–≤–∞–µ—Ç).

**–ì–ª–∞–≤–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è:**

| –§–∏—á–∞                | Manifest v2 ‚ùå                    | Manifest v3 ‚úÖ                       |
| ------------------- | --------------------------------- | ------------------------------------ |
| Background          | Background Page (–≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç) | Service Worker (—Å–ø–∏—Ç –∫–æ–≥–¥–∞ –Ω–µ –Ω—É–∂–µ–Ω) |
| –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ | webRequest (–º–æ—â–Ω–æ, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ)   | declarativeNetRequest (–±—ã—Å—Ç—Ä–æ)       |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å        | –°–ª–∞–±–µ–µ                            | –°—Ç—Ä–æ–∂–µ (CSP)                         |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å  | –ñ—Ä—ë—Ç –ø–∞–º—è—Ç—å                       | –≠–∫–æ–Ω–æ–º–∏—Ç —Ä–µ—Å—É—Ä—Å—ã                     |

**–ù–∞—à–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç v3!** ‚úÖ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ manifest.json –Ω–∞—à–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

```json
{
  "manifest_version": 3,
  "name": "Analytics Extension",
  "version": "1.0",
  "description": "–°–æ–±–∏—Ä–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É –≤–∞—à–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ",

  "permissions": ["storage", "tabs"],

  "background": {
    "service_worker": "dist/background.js"
  },

  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["dist/content.js"]
    }
  ],

  "action": {
    "default_popup": "dist/popup.html",
    "default_icon": {
      "16": "icons/icon16.png",
      "48": "icons/icon48.png",
      "128": "icons/icon128.png"
    }
  },

  "icons": {
    "16": "icons/icon16.png",
    "48": "icons/icon48.png",
    "128": "icons/icon128.png"
  }
}
```

### –†–∞–∑–±–æ—Ä –ø–æ –ø–æ–ª—è–º

#### 1. **manifest_version** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

```json
"manifest_version": 3
```

**–ß—Ç–æ:** –í–µ—Ä—Å–∏—è –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ (–≤—Å–µ–≥–¥–∞ 3 –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π)

#### 2. **name, version, description** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

```json
"name": "Analytics Extension",
"version": "1.0",
"description": "–°–æ–±–∏—Ä–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É..."
```

**–ß—Ç–æ:** –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏

- `name` ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ Chrome Web Store –∏ —Å–ø–∏—Å–∫–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- `version` ‚Äî –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (—Ñ–æ—Ä–º–∞—Ç: major.minor.patch)
- `description` ‚Äî –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–¥–æ 132 —Å–∏–º–≤–æ–ª–æ–≤)

#### 3. **permissions** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```json
"permissions": ["storage", "tabs"]
```

**–ß—Ç–æ:** –†–∞–∑—Ä–µ—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é

**–û—Å–Ω–æ–≤–Ω—ã–µ permissions:**

- `storage` ‚Äî –¥–æ—Å—Ç—É–ø –∫ `chrome.storage` (–¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫)
- `tabs` ‚Äî –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∫–ª–∞–¥–∫–∞—Ö (url, title, favicon)
- `activeTab` ‚Äî –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ (–º–µ–Ω—å—à–µ –ø—Ä–∞–≤)
- `scripting` ‚Äî –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∏–Ω—ä–µ–∫—Ü–∏–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
- `webRequest` ‚Äî –ø–µ—Ä–µ—Ö–≤–∞—Ç —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (v2)
- `declarativeNetRequest` ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ (v3)

**–ù–∞—à–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:**

- ‚úÖ `storage` ‚Äî –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ (isPaused, isMedia, etc)
- ‚úÖ `tabs` ‚Äî –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è url/title/favicon —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–∏

#### 4. **background** (service worker)

```json
"background": {
  "service_worker": "dist/background.js"
}
```

**–ß—Ç–æ:** –§–æ–Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ

**–í v3 —ç—Ç–æ Service Worker:**

- ‚ö° –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω (—ç–∫–æ–Ω–æ–º–∏—Ç –ø–∞–º—è—Ç—å)
- üíæ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ IndexedDB
- üì® –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Content Scripts

**–û—Ç–ª–∏—á–∏–µ –æ—Ç v2:**

```json
// v2 (—Å—Ç–∞—Ä–æ–µ) ‚ùå
"background": {
  "scripts": ["background.js"],
  "persistent": true  // –í—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
}

// v3 (–Ω–æ–≤–æ–µ) ‚úÖ
"background": {
  "service_worker": "background.js"  // –°–ø–∏—Ç –∫–æ–≥–¥–∞ –Ω–µ –Ω—É–∂–µ–Ω
}
```

#### 5. **content_scripts**

```json
"content_scripts": [{
  "matches": ["<all_urls>"],
  "js": ["dist/content.js"]
}]
```

**–ß—Ç–æ:** –°–∫—Ä–∏–ø—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö

**–ü–æ–ª—è:**

- `matches` ‚Äî –Ω–∞ –∫–∞–∫–∏—Ö —Å–∞–π—Ç–∞—Ö –∑–∞–ø—É—Å–∫–∞—Ç—å
  - `<all_urls>` ‚Äî –Ω–∞ –í–°–ï–• —Å–∞–π—Ç–∞—Ö
  - `https://youtube.com/*` ‚Äî —Ç–æ–ª—å–∫–æ YouTube
  - `https://*/*` ‚Äî –≤—Å–µ HTTPS —Å–∞–π—Ç—ã
- `js` ‚Äî –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å
- `run_at` ‚Äî –∫–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
  - `document_start` ‚Äî –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
  - `document_end` ‚Äî –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  - `document_idle` ‚Äî –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

**–ü—Ä–∏–º–µ—Ä –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–∞–π—Ç–æ–≤:**

```json
"content_scripts": [{
  "matches": ["https://youtube.com/*", "https://twitch.tv/*"],
  "js": ["dist/content.js"],
  "run_at": "document_idle"
}]
```

#### 6. **action** (popup –∏ –∏–∫–æ–Ω–∫–∞)

```json
"action": {
  "default_popup": "dist/popup.html",
  "default_icon": {
    "16": "icons/icon16.png",
    "48": "icons/icon48.png",
    "128": "icons/icon128.png"
  }
}
```

**–ß—Ç–æ:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ

**–ü–æ–ª—è:**

- `default_popup` ‚Äî HTML —Ñ–∞–π–ª, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∏–∫–æ–Ω–∫—É
- `default_icon` ‚Äî –∏–∫–æ–Ω–∫–∏ —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤:
  - `16px` ‚Äî –º–∞–ª–µ–Ω—å–∫–∞—è –∏–∫–æ–Ω–∫–∞ –≤ –º–µ–Ω—é
  - `48px` ‚Äî —Å—Ä–µ–¥–Ω—è—è (Chrome Web Store)
  - `128px` ‚Äî –±–æ–ª—å—à–∞—è (—É—Å—Ç–∞–Ω–æ–≤–∫–∞)

**–í v2 —ç—Ç–æ –Ω–∞–∑—ã–≤–∞–ª–æ—Å—å `browser_action`:**

```json
// v2 ‚ùå
"browser_action": { ... }

// v3 ‚úÖ
"action": { ... }
```

#### 7. **icons** (–∏–∫–æ–Ω–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)

```json
"icons": {
  "16": "icons/icon16.png",
  "48": "icons/icon48.png",
  "128": "icons/icon128.png"
}
```

**–ß—Ç–æ:** –ò–∫–æ–Ω–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç –≤ Chrome

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:**

- 16px ‚Äî –≤ –ø–∞–Ω–µ–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- 48px ‚Äî –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `chrome://extensions/`
- 128px ‚Äî –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –≤ Chrome Web Store

### Host Permissions (–Ω–æ–≤–æ–µ –≤ v3)

–í v3 –¥–æ—Å—Ç—É–ø –∫ —Å–∞–π—Ç–∞–º –≤—ã–Ω–µ—Å–µ–Ω –æ—Ç–¥–µ–ª—å–Ω–æ:

```json
"host_permissions": [
  "https://youtube.com/*",
  "https://google.com/*"
]
```

**–ó–∞—á–µ–º:** –ë–æ–ª–µ–µ —è–≤–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ —Å–∞–π—Ç–∞–º (–ø–æ–≤—ã—à–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

**–ù–∞—à–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç** ‚Äî –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `matches` –≤ `content_scripts`

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è

#### web_accessible_resources

–§–∞–π–ª—ã, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü:

```json
"web_accessible_resources": [{
  "resources": ["images/*.png"],
  "matches": ["<all_urls>"]
}]
```

#### commands (–≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏)

```json
"commands": {
  "toggle-feature": {
    "suggested_key": {
      "default": "Ctrl+Shift+Y"
    },
    "description": "–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Å–±–æ—Ä"
  }
}
```

### –ö–∞–∫ Chrome –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ?

1. **–ß–∏—Ç–∞–µ—Ç manifest.json** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–µ—Ä—Å–∏—é, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
2. **–ó–∞–ø—É—Å–∫–∞–µ—Ç Service Worker** (`background.service_worker`)
3. **–ò–Ω—ä–µ–∫—Ç–∏—Ä—É–µ—Ç Content Scripts** –Ω–∞ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`content_scripts.matches`)
4. **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–∫–æ–Ω–∫—É** –≤ –ø–∞–Ω–µ–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π (`action`)
5. **–ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∏–∫–æ–Ω–∫—É** ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `default_popup`

### –ò—Ç–æ–≥–æ –ø—Ä–æ Manifest v3:

‚úÖ **–ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥** —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–∫–∞–∫ package.json)
‚úÖ **Manifest v3** ‚Äî –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ, –±—ã—Å—Ç—Ä–µ–µ)
‚úÖ **Service Worker** –≤–º–µ—Å—Ç–æ Background Page (—ç–∫–æ–Ω–æ–º–∏—Ç –ø–∞–º—è—Ç—å)
‚úÖ **Permissions** ‚Äî —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å —á—Ç–æ –Ω—É–∂–Ω–æ
‚úÖ **content_scripts.matches** ‚Äî –Ω–∞ –∫–∞–∫–∏—Ö —Å–∞–π—Ç–∞—Ö –∑–∞–ø—É—Å–∫–∞—Ç—å
‚úÖ **action.default_popup** ‚Äî –∫–∞–∫–æ–π HTML –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏ –∫–ª–∏–∫–µ
‚úÖ **–ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º** –≤—Å–µ–≥–¥–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–Ω—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –ß—Ç–æ —Å–æ–±–∏—Ä–∞–µ–º:

- ‚úÖ `page_view` ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ `active_time` ‚Äî –∞–∫—Ç–∏–≤–Ω–æ–µ –≤—Ä–µ–º—è (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫)
- ‚úÖ `scroll` ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —Å–∫—Ä–æ–ª–ª–∞
- ‚úÖ `click` ‚Äî –∫–ª–∏–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ `media_play/pause/ended` ‚Äî –º–µ–¥–∏–∞-—Å–æ–±—ã—Ç–∏—è
- ‚úÖ `performance` ‚Äî TTFB

### –ö–∞–∫ —Å—á–∏—Ç–∞–µ–º:

- **–í—Ä–µ–º—è –Ω–∞ —Å–∞–π—Ç–µ** ‚Äî —Å—É–º–º–∞ –≤—Å–µ—Ö `active_time` –∑–∞ –¥–µ–Ω—å
- **–°—Ä–µ–¥–Ω–∏–π —Å–∫—Ä–æ–ª–ª** ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Å–µ—Ö `scroll` —Å–æ–±—ã—Ç–∏–π
- **TTFB** ‚Äî –∏–∑ `performance.timing.responseStart - requestStart`
- **–°–æ–±—ã—Ç–∏—è/–º–∏–Ω** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 —Å–µ–∫
- **–ó–∞–¥–µ—Ä–∂–∫–∞** ‚Äî `saved_at - ts` (—Å—Ä–µ–¥–Ω–µ–µ)

---

## üéØ –ò—Ç–æ–≥

### –ß—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å:

‚úÖ –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ Chrome Extension
‚úÖ 3 —Ä–µ–∂–∏–º–∞ UI (Basic/Pro/Enterprise)
‚úÖ –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–≤—Ä–µ–º—è, —Å–∫—Ä–æ–ª–ª, –º–µ–¥–∏–∞, TTFB)
‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV/JSON
‚úÖ –†–µ–∞–ª—Ç–∞–π–º-–º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
‚úÖ TypeScript + React + Chakra UI

## üöÄ TTFB (Time To First Byte) ‚Äî —á—Ç–æ —ç—Ç–æ –∏ –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –ß—Ç–æ —Ç–∞–∫–æ–µ TTFB?

**TTFB (Time To First Byte)** ‚Äî —ç—Ç–æ –≤—Ä–µ–º—è –æ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–∞ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è **–ø–µ—Ä–≤–æ–≥–æ –±–∞–π—Ç–∞** –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞.

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–µ—Ä–≤–µ—Ä –¥—É–º–∞–µ—Ç –ø–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –Ω–∞—á–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ.

```
–ë—Ä–∞—É–∑–µ—Ä                            –°–µ—Ä–≤–µ—Ä
   ‚îÇ                                  ‚îÇ
   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ó–∞–ø—Ä–æ—Å GET /page ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ
   ‚îÇ                                  ‚îÇ ‚è∞ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
   ‚îÇ                                  ‚îÇ    - –ß—Ç–µ–Ω–∏–µ –∏–∑ –±–∞–∑—ã
   ‚îÇ                                  ‚îÇ    - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML
   ‚îÇ                                  ‚îÇ    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
   ‚îÇ                                  ‚îÇ
   ‚îÇ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ü–µ—Ä–≤—ã–π –±–∞–π—Ç (HTTP 200) ‚îÄ‚îÄ‚îÄ‚îÇ
   ‚Üë
   TTFB = –≤—Ä–µ–º—è –æ—Ç –∑–∞–ø—Ä–æ—Å–∞ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –±–∞–π—Ç–∞
```

### –ß—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ TTFB?

**–•–æ—Ä–æ—à–∏–π TTFB:** < 200ms ‚úÖ
**–°—Ä–µ–¥–Ω–∏–π TTFB:** 200-500ms ‚ö†Ô∏è
**–ü–ª–æ—Ö–æ–π TTFB:** > 500ms ‚ùå

**–§–∞–∫—Ç–æ—Ä—ã:**

- üåç **–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞** (–°–®–ê vs –†–æ—Å—Å–∏—è)
- üóÑÔ∏è **–°–∫–æ—Ä–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** (–±—ã—Å—Ç—Ä—ã–π Redis vs –º–µ–¥–ª–µ–Ω–Ω—ã–π MySQL)
- ‚öôÔ∏è **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä** (1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å vs 10000)
- üì¶ **–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö** (–ø—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ vs —Å–ª–æ–∂–Ω—ã–π API)
- üî• **CDN –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** (–µ—Å—Ç—å –∫—ç—à vs –Ω–µ—Ç –∫—ç—à–∞)

### –ó–∞—á–µ–º –Ω–∞–º TTFB –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ?

**–ß—Ç–æ–±—ã –ø–æ–Ω–∏–º–∞—Ç—å:**

- üìä –ö–∞–∫–∏–µ —Å–∞–π—Ç—ã –±—ã—Å—Ç—Ä—ã–µ, –∫–∞–∫–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã–µ
- üê¢ –ì–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç—Ä–∞—Ç–∏—Ç –≤—Ä–µ–º—è –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ
- üîç –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ä–≤–µ—Ä–æ–º (–µ—Å–ª–∏ TTFB > 1000ms ‚Äî —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫)
- üìà –î–∏–Ω–∞–º–∏–∫–∞ (–≤—á–µ—Ä–∞ –±—ã–ª–æ 200ms, —Å–µ–≥–æ–¥–Ω—è 800ms ‚Äî —Å–µ—Ä–≤–µ—Ä —É–ø–∞–ª?)

---

### –ö–∞–∫ –º—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ TTFB?

#### –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Performance API

**Content Script** (`src/content.tsx`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π API `performance.timing`:

```typescript
window.addEventListener("load", () => {
  const perfData = performance.timing;

  // –°—á–∏—Ç–∞–µ–º TTFB
  const ttfb = perfData.responseStart - perfData.requestStart;

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ Background
  chrome.runtime.sendMessage({
    type: "performance",
    ttfb: ttfb,
    page: {
      url: window.location.href,
      title: document.title,
      favicon: getFavicon(),
    },
  });
});
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. –°–æ–±—ã—Ç–∏–µ `load` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å –ø–æ–ª–Ω–æ—Å—Ç—å—é
2. `performance.timing.requestStart` ‚Äî –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
3. `performance.timing.responseStart` ‚Äî –≤—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –±–∞–π—Ç–∞
4. `ttfb = responseStart - requestStart` ‚Äî —Ä–∞–∑–Ω–∏—Ü–∞ = TTFB
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ `performance` –≤ Background Worker

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (Navigation Timing API v2):**

```typescript
const perfEntries = performance.getEntriesByType("navigation")[0];
const ttfb = perfEntries.responseStart - perfEntries.requestStart;
```

#### –®–∞–≥ 2: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ IndexedDB

**Background Worker** (`src/background.ts`) –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç:

```typescript
chrome.runtime.onMessage.addListener((message) => {
  if (message.type === "performance") {
    saveEvent({
      type: "performance",
      ts: new Date().toISOString(),
      ttfb: message.ttfb, // ‚Üê –°–æ—Ö—Ä–∞–Ω—è–µ–º TTFB (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
      page: message.page,
    });
  }
});
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏—è –≤ IndexedDB:**

```json
{
  "id": 42,
  "type": "performance",
  "ts": "2025-10-06T14:30:00.000Z",
  "ttfb": 245, // –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã
  "page": {
    "url": "https://youtube.com",
    "title": "YouTube",
    "favicon": "https://youtube.com/favicon.ico"
  }
}
```

#### –®–∞–≥ 3: –ü–æ–¥—Å—á—ë—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ TTFB

**–§—É–Ω–∫—Ü–∏—è –≤ `db.ts`** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–≥–æ TTFB –∑–∞ —Å–µ–≥–æ–¥–Ω—è:

```typescript
export async function getAverageTTFBToday(): Promise<string> {
  const db = await dbPromise;
  const allEvents = await db.getAll("events");

  // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è
  const today = new Date().toDateString();
  const todayEvents = allEvents.filter((event) => {
    return new Date(event.ts).toDateString() === today;
  });

  // –ë–µ—Ä—ë–º —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è —Ç–∏–ø–∞ "performance"
  const perfEvents = todayEvents.filter(
    (e) => e.type === "performance" && e.ttfb
  );

  if (perfEvents.length === 0) return "0ms";

  // –°—á–∏—Ç–∞–µ–º —Å—Ä–µ–¥–Ω–µ–µ
  const totalTTFB = perfEvents.reduce(
    (sum, event) => sum + (event.ttfb || 0),
    0
  );
  const avgTTFB = Math.round(totalTTFB / perfEvents.length);

  return `${avgTTFB}ms`;
}
```

#### –®–∞–≥ 4: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ Popup

**Enterprise —Ä–µ–∂–∏–º** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–µ–¥–Ω–∏–π TTFB:

```typescript
const [avgTTFB, setAvgTTFB] = useState<string>("0ms");

useEffect(() => {
  const fetchTTFB = async () => {
    const ttfb = await getAverageTTFBToday();
    setAvgTTFB(ttfb);
  };
  fetchTTFB();
}, []);

// –í UI
<Text>–°—Ä–µ–¥–Ω–∏–π TTFB: {avgTTFB}</Text>;
```

---

### –ü—Ä–∏–º–µ—Ä: –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç TTFB –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ

```typescript
// 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç https://youtube.com
// 2. –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç GET-–∑–∞–ø—Ä–æ—Å: 10:00:00.000
// 3. –°–µ—Ä–≤–µ—Ä –¥—É–º–∞–µ—Ç... (–æ–±—Ä–∞–±–æ—Ç–∫–∞, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –∫—ç—à)
// 4. –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–≤—ã–π –±–∞–π—Ç: 10:00:00.245
// 5. TTFB = 245ms ‚úÖ

// Content Script –ª–æ–≤–∏—Ç —Å–æ–±—ã—Ç–∏–µ load
window.addEventListener("load", () => {
  const ttfb =
    performance.timing.responseStart - performance.timing.requestStart;
  // ttfb = 245

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Background
  chrome.runtime.sendMessage({
    type: "performance",
    ttfb: 245,
    page: { url: "youtube.com", title: "YouTube" },
  });
});

// Background —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ IndexedDB
// Popup —á–∏—Ç–∞–µ—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "–°—Ä–µ–¥–Ω–∏–π TTFB: 245ms"
```

---

### –ò—Ç–æ–≥–æ –ø—Ä–æ TTFB:

‚úÖ **TTFB** ‚Äî –≤—Ä–µ–º—è –¥–æ –ø–µ—Ä–≤–æ–≥–æ –±–∞–π—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
‚úÖ **–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏** —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–µ —Å–µ—Ç–∏!)
‚úÖ **Performance API** ‚Äî –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π API –¥–ª—è –º–µ—Ç—Ä–∏–∫
‚úÖ **–°—á–∏—Ç–∞–µ–º —Å—Ä–µ–¥–Ω–µ–µ** –∑–∞ –¥–µ–Ω—å –ø–æ –≤—Å–µ–º —Å–∞–π—Ç–∞–º
‚úÖ **–û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤ Enterprise —Ä–µ–∂–∏–º–µ** ‚Äî –≤–∏–¥–Ω–æ –∫–∞–∫–∏–µ —Å–∞–π—Ç—ã –º–µ–¥–ª–µ–Ω–Ω—ã–µ

---

## üìä –ü—Ä–æ—Ñ–∏–ª—å —Å–±–æ—Ä–∞ (–¢–µ–ª–µ–º–µ—Ç—Ä–∏—è –∫–∞—á–µ—Å—Ç–≤–∞) ‚Äî —á—Ç–æ —ç—Ç–æ –∏ –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –ß—Ç–æ —Ç–∞–∫–æ–µ –ü—Ä–æ—Ñ–∏–ª—å —Å–±–æ—Ä–∞?

**–ü—Ä–æ—Ñ–∏–ª—å —Å–±–æ—Ä–∞** ‚Äî —ç—Ç–æ –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã **—Å–∞–º–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è** (–Ω–µ —Å–∞–π—Ç–æ–≤!).

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ ‚Äî –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–æ–±–∏—Ä–∞–µ—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ.

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**

- ‚ö° **–°–æ–±—ã—Ç–∏—è/–º–∏–Ω** ‚Äî —Å–∫–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –º–∏–Ω—É—Ç—É
- ‚è±Ô∏è **–ó–∞–¥–µ—Ä–∂–∫–∞** ‚Äî –≤—Ä–µ–º—è –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è –¥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±–∞–∑—É
- ‚úÖ **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å** ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- üíª **CPU %** ‚Äî –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ó–∞—á–µ–º –Ω—É–∂–Ω–æ?**

- üêõ **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º** ‚Äî –µ—Å–ª–∏ –∑–∞–¥–µ—Ä–∂–∫–∞ > 500ms, —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫
- üìà **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –Ω–µ —Ç–æ—Ä–º–æ–∑–∏—Ç –ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä
- üîç **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** ‚Äî –≤—Å—ë –ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### –ë–ª–æ–∫ "–ü–†–û–§–ò–õ–¨ –°–ë–û–†–ê" –≤ Enterprise —Ä–µ–∂–∏–º–µ

–í Enterprise —Ä–µ–∂–∏–º–µ –µ—Å—Ç—å 4 –∫–∞—Ä—Ç–æ—á–∫–∏ –º–µ—Ç—Ä–∏–∫:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              –ü–†–û–§–ò–õ–¨ –°–ë–û–†–ê                              ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ–°–æ–±—ã—Ç–∏—è/–º–∏–Ω‚îÇ  ‚îÇ–£—Å–ø–µ—à–Ω–æ—Å—Ç—å‚îÇ  ‚îÇ –ó–∞–¥–µ—Ä–∂–∫–∞ ‚îÇ  ‚îÇ  CPU    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    45    ‚îÇ  ‚îÇ  99,8%   ‚îÇ  ‚îÇ  120ms   ‚îÇ  ‚îÇ  1,2%   ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 1Ô∏è‚É£ –°–æ–±—ã—Ç–∏—è/–º–∏–Ω (Events Per Minute)

### –ß—Ç–æ —ç—Ç–æ?

–°–∫–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏–π —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç **–∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É**.

**–ü—Ä–∏–º–µ—Ä—ã:**

- üìÑ –û—Ç–∫—Ä—ã–ª 3 —Å–∞–π—Ç–∞ ‚Üí 3 —Å–æ–±—ã—Ç–∏—è `page_view`
- üìú –°–∫—Ä–æ–ª–ª–∏–ª 10 —Ä–∞–∑ ‚Üí 10 —Å–æ–±—ã—Ç–∏–π `scroll`
- ‚è±Ô∏è –ë—ã–ª –∞–∫—Ç–∏–≤–µ–Ω 12 —Å–µ–∫—É–Ω–¥ ‚Üí 2-3 —Å–æ–±—ã—Ç–∏—è `active_time` (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫)
- **–ò—Ç–æ–≥–æ:** ~15-20 —Å–æ–±—ã—Ç–∏–π/–º–∏–Ω

**–ù–æ—Ä–º–∞:**

- ‚úÖ < 50 —Å–æ–±—ã—Ç–∏–π/–º–∏–Ω ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚ö†Ô∏è 50-100 ‚Äî –∞–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- ‚ùå > 100 ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ —á—Ç–æ-—Ç–æ –∑–∞—Ü–∏–∫–ª–∏–ª–æ—Å—å

---

### –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏?

#### –®–∞–≥ 1: –§—É–Ω–∫—Ü–∏—è –≤ `db.ts`

```typescript
export async function getEventsPerMinute(): Promise<number> {
  const db = await dbPromise;
  const allEvents = await db.getAll("events");

  // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 —Å–µ–∫—É–Ω–¥
  const oneMinuteAgo = new Date(Date.now() - 60 * 1000);

  const recentEvents = allEvents.filter((event) => {
    const eventDate = new Date(event.ts);
    return eventDate >= oneMinuteAgo;
  });

  return recentEvents.length; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –∏–∑ IndexedDB
2. –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 —Å–µ–∫—É–Ω–¥
3. –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

#### –®–∞–≥ 2: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ Popup

```typescript
const [eventsPerMin, setEventsPerMin] = useState<number>(0);

useEffect(() => {
  const fetchEventsPerMin = async () => {
    const epm = await getEventsPerMinute();
    setEventsPerMin(epm);
  };

  fetchEventsPerMin();

  // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
  const interval = setInterval(fetchEventsPerMin, 5000);
  return () => clearInterval(interval);
}, []);

// –í UI
<Text>{eventsPerMin}</Text>;
```

---

## 2Ô∏è‚É£ –ó–∞–¥–µ—Ä–∂–∫–∞ (Latency)

### –ß—Ç–æ —ç—Ç–æ?

–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç **—Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è** –¥–æ **—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ IndexedDB**.

**–§–æ—Ä–º—É–ª–∞:**

```
–ó–∞–¥–µ—Ä–∂–∫–∞ = saved_at - ts
```

**–ü—Ä–∏–º–µ—Ä:**

- –°–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–æ –≤ Content Script: `10:00:00.000`
- –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Background: `10:00:00.050` (+50ms)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ IndexedDB: `10:00:00.120` (+70ms)
- **–ó–∞–¥–µ—Ä–∂–∫–∞ = 120ms** ‚úÖ

**–ù–æ—Ä–º–∞:**

- ‚úÖ < 200ms ‚Äî –æ—Ç–ª–∏—á–Ω–æ
- ‚ö†Ô∏è 200-500ms ‚Äî –ø—Ä–∏–µ–º–ª–µ–º–æ
- ‚ùå > 500ms ‚Äî –ø—Ä–æ–±–ª–µ–º—ã (–º–µ–¥–ª–µ–Ω–Ω—ã–π –¥–∏—Å–∫, –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö)

---

### –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏?

#### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `saved_at` –≤ EventRecord

```typescript
interface EventRecord {
  id?: number;
  type: string;
  ts: string; // ‚Üê –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
  saved_at?: string; // ‚Üê –í—Ä–µ–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–ù–û–í–û–ï)
  // ...
}
```

#### –®–∞–≥ 2: –°–æ—Ö—Ä–∞–Ω—è—Ç—å `saved_at` –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –±–∞–∑—É

```typescript
export async function saveEvent(event: EventRecord) {
  const db = await dbPromise;

  const eventWithSaveTime = {
    ...event,
    saved_at: new Date().toISOString(), // ‚Üê –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  };

  await db.add("events", eventWithSaveTime);
}
```

#### –®–∞–≥ 3: –ü–æ–¥—Å—á—ë—Ç —Å—Ä–µ–¥–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–∏

```typescript
export async function getAverageLatency(): Promise<string> {
  const db = await dbPromise;
  const allEvents = await db.getAll("events");

  // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É (—É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å saved_at)
  const oneMinuteAgo = new Date(Date.now() - 60 * 1000);

  const recentEvents = allEvents.filter((event) => {
    const eventDate = new Date(event.ts);
    return eventDate >= oneMinuteAgo && event.saved_at;
  });

  if (recentEvents.length === 0) return "0ms";

  // –°—á–∏—Ç–∞–µ–º —Å—Ä–µ–¥–Ω—é—é –∑–∞–¥–µ—Ä–∂–∫—É
  const totalLatency = recentEvents.reduce((sum, event) => {
    const created = new Date(event.ts).getTime();
    const saved = new Date(event.saved_at!).getTime();
    return sum + (saved - created);
  }, 0);

  const avgLatency = totalLatency / recentEvents.length;

  return Math.round(avgLatency) + "ms";
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. –ë–µ—Ä—ë–º —Å–æ–±—ã—Ç–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è: `saved_at - ts` = –∑–∞–¥–µ—Ä–∂–∫–∞
3. –°—á–∏—Ç–∞–µ–º —Å—Ä–µ–¥–Ω–µ–µ
4. –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ "120ms"

#### –®–∞–≥ 4: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ Popup

```typescript
const [latency, setLatency] = useState<string>("0ms");

useEffect(() => {
  const fetchLatency = async () => {
    const lat = await getAverageLatency();
    setLatency(lat);
  };

  fetchLatency();

  // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
  const interval = setInterval(fetchLatency, 5000);
  return () => clearInterval(interval);
}, []);

// –í UI
<Text>{latency}</Text>;
```

---

### –ß—Ç–æ —ç—Ç–æ?

–ü—Ä–æ—Ü–µ–Ω—Ç —Å–æ–±—ã—Ç–∏–π, –∫–æ—Ç–æ—Ä—ã–µ **—É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å** –≤ IndexedDB vs **–ø–æ–ø—ã—Ç–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏**.

**–§–æ—Ä–º—É–ª–∞:**

```
–£—Å–ø–µ—à–Ω–æ—Å—Ç—å = (–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö / –ü–æ–ø—ã—Ç–æ–∫) * 100%
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú—ã –Ω–µ –∑–Ω–∞–µ–º —Å–∫–æ–ª—å–∫–æ –ø–æ–ø—ã—Ç–æ–∫ –±—ã–ª–æ, —Ç–æ–ª—å–∫–æ —Å–∫–æ–ª—å–∫–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å.

**–ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ (—Ñ–µ–π–∫-–º–µ—Ç—Ä–∏–∫–∞):**

- –ï—Å–ª–∏ –∑–∞ –º–∏–Ω—É—Ç—É > 0 —Å–æ–±—ã—Ç–∏–π ‚Üí `100%`
- –ò–Ω–∞—á–µ ‚Üí `0%`

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (—Å–ª–æ–∂–Ω–æ–µ):**

1. Content Script —Å—á–∏—Ç–∞–µ—Ç –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
2. Background —Å—á–∏—Ç–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
3. –•—Ä–∞–Ω–∏–º —Å—á—ë—Ç—á–∏–∫–∏ –≤ `chrome.storage`
4. –î–µ–ª–∏–º: `—É—Å–ø–µ—à–Ω—ã–µ / –ø–æ–ø—ã—Ç–∫–∏ * 100`

---

---

chrome.storage ‚Äî —ç—Ç–æ –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Chrome –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è. –ö–∞–∫ localStorage, –Ω–æ –ª—É—á—à–µ:

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

- ‚òÅÔ∏è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (–µ—Å–ª–∏ —é–∑–µ—Ä –∑–∞–ª–æ–≥–∏–Ω–µ–Ω –≤ Chrome)
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI)
- üì¶ –ë–æ–ª—å—à–µ –º–µ—Å—Ç–∞ ‚Äî 100KB (vs 5MB localStorage, –Ω–æ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
- üîÑ –°–æ–±—ã—Ç–∏–π–Ω–∞—è –º–æ–¥–µ–ª—å ‚Äî –º–æ–∂–Ω–æ —Å–ª—É—à–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

---

–ö–∞–∫–∏–µ —Ç–æ–≥–ª—ã —Ç—ã —Ö—Ä–∞–Ω—è—à—å?

–°—É–¥—è –ø–æ –∫–æ–¥—É, —É —Ç–µ–±—è 4 —Ç–æ–≥–ª–∞:

{
isPaused: false, // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–±–æ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é
isIncognito: true, // –°–æ–±–∏—Ä–∞—Ç—å –ª–∏ –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ
isClick: false, // –°–æ–±–∏—Ä–∞—Ç—å –ª–∏ –∫–ª–∏–∫–∏/—Å–∫—Ä–æ–ª–ª
isMedia: false // –°–æ–±–∏—Ä–∞—Ç—å –ª–∏ –º–µ–¥–∏–∞ (play/pause)
}

---

–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç? (–Ω–∞ –ø—Ä–∏–º–µ—Ä–µ isPaused)

1Ô∏è‚É£ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ Content Script

// –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏
let pausedState = false;

// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Üí —á–∏—Ç–∞–µ–º –∏–∑ chrome.storage
chrome.storage.sync.get(["isPaused"], (result) => {
pausedState = result.isPaused ?? false; // ?? false = –¥–µ—Ñ–æ–ª—Ç –µ—Å–ª–∏ –Ω–µ—Ç
console.log("Initial pausedState:", pausedState);
});

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. Content Script –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
2. –î–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ chrome.storage.sync ‚Üí "–¥–∞–π –º–Ω–µ isPaused"
3. Chrome –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ (–∏–ª–∏ undefined –µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π —Ä–∞–∑)
4. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é pausedState

---

2Ô∏è‚É£ –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)

chrome.storage.onChanged.addListener((changes, area) => {
if (area === "sync" && changes.isPaused) {
pausedState = changes.isPaused.newValue; // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
console.log("Paused state changed:", pausedState);
}
});

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

- –ï—Å–ª–∏ –≤ Popup –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª —Ç–æ–≥–ª ‚Üí –∑–Ω–∞—á–µ–Ω–∏–µ isPaused –º–µ–Ω—è–µ—Ç—Å—è
- Chrome –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø–æ–≤–µ—â–∞–µ—Ç –≤—Å–µ Content Scripts
- Content Script –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ onChanged
- –û–±–Ω–æ–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é pausedState

–≠—Ç–æ –∫–∞–∫ React state, —Ç–æ–ª—å–∫–æ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –¥–ª—è –≤—Å–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è!

---

3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–±—ã—Ç–∏—è

async function isPaused(): Promise<boolean> {
return pausedState; // –ü—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–∑ –ø–∞–º—è—Ç–∏ (–±—ã—Å—Ç—Ä–æ!)
}

// –í –∫–æ–¥–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–±—ã—Ç–∏—è
if (await isPaused()) {
console.log("Paused, not sending event");
return; // –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
}

–ü–æ—á–µ–º—É –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è pausedState, –∞ –Ω–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —á–∏—Ç–∞—Ç—å –∏–∑ chrome.storage?

- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ ‚Äî —á—Ç–µ–Ω–∏–µ –∏–∑ –ø–∞–º—è—Ç–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –∏–∑ storage ~10ms
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ ‚Äî –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É
- ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ ‚Äî onChanged –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏

---

–ö–∞–∫ Popup –º–µ–Ω—è–µ—Ç —Ç–æ–≥–ª—ã?
